{{#section 'js'}}
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script language="javascript" type="text/javascript">
	function limitText(limit) {
		const countdown = limit - $("#commentContent").val().length
		$("#commentCountdown").text(`Số kí tự còn lại là ${countdown}`)
	}
	$(document).ready(function(){
		const countdown = 1000 - $("#commentContent").val().length
		$("#commentCountdown").text(`Số kí tự còn lại là ${countdown}`)
		$("#submit,#commentContent").on( "click", function(){
			$.ajax({
				url: location.protocol + '//' + location.host + '/api/auth',
				method: "get",
				success: function(data){
					if (data === false){
						$("#commentContent").blur();
						Swal.fire({
							icon: 'warning',
							title: 'Đăng nhập để tham gia bình luận'
						}).then((result)=>{
							
						})
					}
					else {
						$('#form').off('submit').submit();
					}
				},
				error: function(jqXHR, textStatus, errorThrown){
					Swal.fire({
						title: 'Error!',
						text: 'error ' + textStatus + " " + errorThrown,
						icon: 'error',
						confirmButtonText: 'OK'
					})
				}
			})
		})
	})
</script>
{{/section}}

<nav aria-label="breadcrumb">
  <ol class="breadcrumb">
    <li class="breadcrumb-item"><a href="/mainpage">Home</a></li>
    <li class="breadcrumb-item"><a href="/{{article.CatLink}}">{{article.CatName}}</a></li>
    <li class="breadcrumb-item active" aria-current="page"><a href="/{{article.CatLink}}/{{article.BranchLink}}">{{article.BranchName}}</a></li>
  </ol>
</nav>
<div class="container-fluid d-flex">
	<div class="row justify-content-center">
		<div class="col-sm-8 justify-content-center">
			<div class="shadow-lg p-5 mb-3">
				<h2>{{article.Title}}</h2>
				<a class="badge badge-pill badge-primary">
					<i class="fa fa-user-circle" aria-hidden="true"></i>
					{{article.PenName}}
				</a>
				<span class="badge badge-pill badge-success">
					<i class="fa fa-eye" aria-hidden="true"></i>
					{{article.Views}}
				</span>
				<a class="badge badge-pill badge-dark" href="#comments">
					<i class="fa fa-comments" aria-hidden="true"></i>
					{{comments.length}}
				</a>
				<span class="badge badge-pill badge-info">
					<i class="fa fa-calendar" aria-hidden="true"></i>
					{{article.DateOfPublish}}
				</span>	
				<br>
				<img src="/{{article.ImageLink}}" class="img-fluid" alt="">
				{{{article.Content}}}
			</div>
			<div id="comments">
				<div class="card shadow">
					<div class="card-header">
						Bình luận
					</div>
					<div class="card-body">
						<form method="POST" action="/comment/add/{{article.ArtID}}" id="form">
							<textarea id="commentContent"class="form-control" name="limitedtextarea" id="" rows="3" placeholder="Mời bạn bình luận tại đây" maxlength="1000" onkeydown="limitText(1000)" onkeyup="limitText(1000)" required></textarea>	
							<span id="commentCountdown"></span>
							<button id="submit" class="btn btn-primary my-2 float-right" type="submit">
								<i class="fa fa-paper-plane-o" aria-hidden="true"></i>
								Gửi bình luận
							</button>
						</form>
						{{#each comments}}
						<div class="card p-2 mt-2 container-fluid">
							<div class="d-flex">
								<a href="/users/info/{{UserID}}">
									<img src="{{avatar}}" class="rounded-circle" width="40" height="40" alt="">
								</a>
								<div class="flex-grow-1 pl-2">
									<a class="h6 m-0" href="/users/info/{{UserID}}">{{Name}}</a>
									<p class="small m-0 text-muted">{{Date}}</p>
								</div>
								{{#if MyComment}}
									{{!-- <button type="button" class="btn btn-outline-primary mx-2">
										<i class="fa fa-pencil" aria-hidden="true"></i>
									</button> --}}
									<button type="button" class="btn btn-outline-danger">
										<i class="fa fa-trash" aria-hidden="true"></i>
									</button>
								{{/if}}
							</div>
							<div class="card-body p-0">
								<p class="card-text h7 mb-1">{{Content}}</p>
							</div>
						</div>
						{{/each}}
					</div>	
				</div>
				
			</div>
		</div>
		<div class="col-sm-3">

			<div class="card shadow p-3 mb-3">
				<div class="card-header">
					<i class="fa fa-tags" aria-hidden="true"></i>
					<strong>Tags: </strong>
				</div>
				<div class="card-body">
					{{#each tags}}
					<button type="button" class="btn btn-outline-info" onclick="location.href='/tags/{{TagName}}'">{{TagName}}</button>
					{{/each}}
				</div>
			</div>
			{{#if related}}
				<div class="card shadow">
				<div class="card-header">
					<i class="fa fa-share-alt" aria-hidden="true"></i>
					Bài viết liên quan

				</div>
			</div>
			{{/if}}
		</div>
	</div>
</div>